@using MemberService.Pages.Event
@model IReadOnlyList<EventSignupModel>

<tbody>
    @if (Model.NotAny())
    {
        <tr>
            <td colspan="3" class="text-center text-uppercase text-muted">Ingen</td>
        </tr>
    }

    @for (var i = 0; i < Model.Count; i++)
    {
        var signup = Model[i];
        <tr>
            <td>
                <input type="hidden" asp-for="@Model[i].Id" />
                <input type="checkbox" asp-for="@Model[i].Selected" />
            </td>
            <td>
                <a asp-controller="Members" asp-action="Details" asp-route-id="@signup.UserId" class="text-muted" target="_blank">@signup.FullName</a>
            </td>
            <td>
                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#modal-@signup.Id">
                    @signup.SignedUpAt.ToOsloDate()
                </button>

                <div class="modal fade" id="modal-@signup.Id" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalScrollableTitle">Historikk for @signup.FullName</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body p-0">
                                <table class="table table-striped">
                                    <tr>
                                        <th>Hva?</th>
                                        <th>Hvem?</th>
                                        <th>Når?</th>
                                    </tr>
                                    @foreach (var entry in signup.AuditLog.OrderByDescending(x => x.OccuredAtUtc))
                                    {
                                        <tr>
                                            <td>
                                                @entry.Message
                                            </td>
                                            <td>
                                                <a asp-controller="Members" asp-action="Details" asp-route-id="@entry.UserId" target="_blank">@entry.User.FullName</a>
                                            </td>
                                            <td>
                                                @entry.OccuredAtUtc.ToOsloDate() klokken @entry.OccuredAtUtc.ToOsloTime()
                                            </td>
                                        </tr>
                                    }
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </td>
        </tr>
    }
</tbody>
